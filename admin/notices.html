<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê³µì§€ì‚¬í•­ ê´€ë¦¬ | ì„œìš¸ë¹„ë””ì¹˜ê³¼ ê´€ë¦¬ì</title>
  <meta name="robots" content="noindex, nofollow">
  
  <link rel="icon" type="image/svg+xml" href="../images/icons/favicon.svg">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Pretendard', sans-serif; background: #0a0a0a; color: #fff; min-height: 100vh; }
    
    .admin-layout { display: flex; min-height: 100vh; }
    
    .admin-sidebar { width: 260px; background: #111; border-right: 1px solid rgba(139,90,43,0.2); padding: 24px 0; position: fixed; height: 100vh; }
    .admin-logo { padding: 0 24px 24px; border-bottom: 1px solid rgba(139,90,43,0.2); margin-bottom: 24px; }
    .admin-logo h1 { font-size: 1.25rem; color: #C9A962; display: flex; align-items: center; gap: 8px; }
    .admin-logo span { font-size: 0.75rem; color: rgba(255,255,255,0.5); display: block; margin-top: 4px; }
    .admin-nav { list-style: none; }
    .admin-nav a { display: flex; align-items: center; gap: 12px; padding: 12px 24px; color: rgba(255,255,255,0.7); text-decoration: none; transition: all 0.3s; }
    .admin-nav a:hover { background: rgba(201,169,98,0.1); color: #C9A962; }
    .admin-nav a.active { background: linear-gradient(90deg, rgba(201,169,98,0.2), transparent); color: #C9A962; border-left: 3px solid #C9A962; }
    .admin-nav i { width: 20px; text-align: center; }
    
    .admin-main { flex: 1; margin-left: 260px; padding: 24px; }
    .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; padding-bottom: 16px; border-bottom: 1px solid rgba(139,90,43,0.2); }
    .admin-header h2 { font-size: 1.5rem; display: flex; align-items: center; gap: 12px; }
    .admin-header h2 i { color: #C9A962; }
    .btn-logout { padding: 8px 16px; background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); border-radius: 6px; color: #ef4444; cursor: pointer; font-size: 0.85rem; }
    
    .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px; }
    .search-box { display: flex; align-items: center; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 8px 12px; width: 280px; }
    .search-box i { color: rgba(255,255,255,0.4); margin-right: 8px; }
    .search-box input { background: none; border: none; color: #fff; outline: none; width: 100%; font-size: 0.9rem; }
    .btn-primary { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: linear-gradient(135deg, #8B5A2B, #C9A962); border: none; border-radius: 8px; color: #fff; font-weight: 600; cursor: pointer; }
    
    .data-table { background: rgba(26, 20, 16, 0.6); border: 1px solid rgba(139, 90, 43, 0.2); border-radius: 12px; overflow: hidden; }
    .data-table table { width: 100%; border-collapse: collapse; }
    .data-table th, .data-table td { padding: 14px 16px; text-align: left; }
    .data-table th { background: rgba(139,90,43,0.1); font-weight: 600; font-size: 0.85rem; color: #C9A962; }
    .data-table tr:not(:last-child) { border-bottom: 1px solid rgba(139,90,43,0.1); }
    .data-table tbody tr:hover { background: rgba(201,169,98,0.05); }
    
    .category-badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; }
    .category-badge.important { background: rgba(239,68,68,0.2); color: #ef4444; }
    .category-badge.event { background: rgba(59,130,246,0.2); color: #3b82f6; }
    .category-badge.info { background: rgba(201,169,98,0.2); color: #C9A962; }
    .category-badge.holiday { background: rgba(34,197,94,0.2); color: #22c55e; }
    
    .pin-icon { color: #C9A962; }
    
    .action-btns { display: flex; gap: 8px; }
    .btn-icon { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: rgba(255,255,255,0.7); cursor: pointer; transition: all 0.3s; }
    .btn-icon:hover { background: rgba(201,169,98,0.1); border-color: rgba(201,169,98,0.3); color: #C9A962; }
    .btn-icon.delete:hover { background: rgba(239,68,68,0.1); border-color: rgba(239,68,68,0.3); color: #ef4444; }
    
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
    .modal-overlay.active { display: flex; }
    .modal { background: #1a1510; border: 1px solid rgba(139,90,43,0.3); border-radius: 16px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid rgba(139,90,43,0.2); }
    .modal-header h3 { font-size: 1.25rem; display: flex; align-items: center; gap: 10px; }
    .modal-header h3 i { color: #C9A962; }
    .modal-close { background: none; border: none; color: rgba(255,255,255,0.5); font-size: 1.5rem; cursor: pointer; }
    .modal-body { padding: 24px; }
    .modal-footer { display: flex; justify-content: flex-end; gap: 12px; padding: 16px 24px; border-top: 1px solid rgba(139,90,43,0.2); }
    .btn-secondary { padding: 10px 20px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff; cursor: pointer; }
    
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 500; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #fff; font-size: 0.95rem; outline: none; }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color: rgba(201,169,98,0.5); }
    .form-group textarea { min-height: 150px; resize: vertical; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .checkbox-group { display: flex; align-items: center; gap: 8px; }
    .checkbox-group input { width: auto; }
    
    .loading-state, .empty-state { text-align: center; padding: 60px 20px; color: rgba(255,255,255,0.6); }
    .loading-spinner { width: 40px; height: 40px; border: 3px solid rgba(201,169,98,0.2); border-top-color: #C9A962; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .empty-state i { font-size: 3rem; color: rgba(201,169,98,0.3); margin-bottom: 16px; }
    
    .login-screen { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: linear-gradient(135deg, #0a0a0a 0%, #1a1510 100%); }
    .login-box { text-align: center; max-width: 400px; padding: 40px; }
    .login-box h1 { font-size: 1.75rem; margin-bottom: 8px; color: #C9A962; }
    .login-box p { color: rgba(255,255,255,0.6); margin-bottom: 32px; }
    .btn-google { display: flex; align-items: center; justify-content: center; gap: 12px; width: 100%; padding: 14px 28px; background: #fff; color: #333; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; }
    .btn-google img { width: 20px; height: 20px; }
    
    @media (max-width: 1024px) { .admin-sidebar { display: none; } .admin-main { margin-left: 0; } .form-row { grid-template-columns: 1fr; } }
    @media (max-width: 768px) { .toolbar { flex-direction: column; align-items: stretch; } .search-box { width: 100%; } .data-table { overflow-x: auto; } .data-table table { min-width: 700px; } }
  </style>
</head>
<body>
  <div class="login-screen" id="loginScreen">
    <div class="login-box">
      <h1>ğŸ¦· ì„œìš¸ë¹„ë””ì¹˜ê³¼</h1>
      <p>ê´€ë¦¬ì í˜ì´ì§€ì— ì ‘ê·¼í•˜ë ¤ë©´ ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
      <button class="btn-google" onclick="signInWithGoogle()">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
        Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
      </button>
    </div>
  </div>

  <div class="admin-layout" id="adminLayout" style="display: none;">
    <aside class="admin-sidebar">
      <div class="admin-logo">
        <h1>ğŸ¦· ì„œìš¸ë¹„ë””ì¹˜ê³¼</h1>
        <span>ê´€ë¦¬ì íŒ¨ë„</span>
      </div>
      <nav>
        <ul class="admin-nav">
          <li><a href="index.html"><i class="fas fa-home"></i> ëŒ€ì‹œë³´ë“œ</a></li>
          <li><a href="cases.html"><i class="fas fa-images"></i> Before/After</a></li>
          <li><a href="notices.html" class="active"><i class="fas fa-bullhorn"></i> ê³µì§€ì‚¬í•­</a></li>
          <li><a href="../index.html" target="_blank"><i class="fas fa-external-link-alt"></i> ì‚¬ì´íŠ¸ ë³´ê¸°</a></li>
        </ul>
      </nav>
    </aside>
    
    <main class="admin-main">
      <header class="admin-header">
        <h2><i class="fas fa-bullhorn"></i> ê³µì§€ì‚¬í•­ ê´€ë¦¬</h2>
        <button class="btn-logout" onclick="signOut()"><i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ</button>
      </header>
      
      <div class="toolbar">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="ì œëª©ìœ¼ë¡œ ê²€ìƒ‰..." id="searchInput" oninput="filterNotices()">
        </div>
        <button class="btn-primary" onclick="openModal()">
          <i class="fas fa-plus"></i> ìƒˆ ê³µì§€ ì¶”ê°€
        </button>
      </div>
      
      <div class="data-table">
        <table>
          <thead>
            <tr>
              <th width="40">ê³ ì •</th>
              <th>ì œëª©</th>
              <th width="100">ì¹´í…Œê³ ë¦¬</th>
              <th width="120">ë“±ë¡ì¼</th>
              <th width="100">ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody id="noticesTableBody"></tbody>
        </table>
        <div id="loadingState" class="loading-state"><div class="loading-spinner"></div><p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>
        <div id="emptyState" class="empty-state" style="display: none;"><i class="fas fa-folder-open"></i><p>ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>
      </div>
    </main>
  </div>
  
  <div class="modal-overlay" id="noticeModal">
    <div class="modal">
      <div class="modal-header">
        <h3><i class="fas fa-plus-circle"></i> <span id="modalTitle">ìƒˆ ê³µì§€ ì¶”ê°€</span></h3>
        <button class="modal-close" onclick="closeModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <form id="noticeForm">
          <input type="hidden" id="noticeId">
          <div class="form-group">
            <label>ì œëª© *</label>
            <input type="text" id="noticeTitle" required placeholder="ê³µì§€ì‚¬í•­ ì œëª©">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>ì¹´í…Œê³ ë¦¬ *</label>
              <select id="noticeCategory" required>
                <option value="info">ì•ˆë‚´</option>
                <option value="important">ì¤‘ìš”</option>
                <option value="event">ì´ë²¤íŠ¸</option>
                <option value="holiday">íœ´ì§„</option>
              </select>
            </div>
            <div class="form-group">
              <label>ìƒë‹¨ ê³ ì •</label>
              <div class="checkbox-group" style="padding-top: 8px;">
                <input type="checkbox" id="noticePinned">
                <label for="noticePinned">ìƒë‹¨ì— ê³ ì •</label>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label>ë‚´ìš© *</label>
            <textarea id="noticeContent" required placeholder="ê³µì§€ì‚¬í•­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
        <button class="btn-primary" onclick="saveNotice()"><i class="fas fa-save"></i> ì €ì¥</button>
      </div>
    </div>
  </div>

  <script>
    const firebaseConfig = { apiKey: "demo", authDomain: "demo.firebaseapp.com", projectId: "demo" };
    let auth;
    try { firebase.initializeApp(firebaseConfig); auth = firebase.auth(); } catch(e) {}
    
    const TABLE_NAME = 'notices';
    let allNotices = [];
    let editingId = null;
    
    document.addEventListener('DOMContentLoaded', function() {
      const isDemoMode = true;
      if (isDemoMode) { showAdminPanel(); loadNotices(); }
      else if (auth) { auth.onAuthStateChanged(user => user ? (showAdminPanel(), loadNotices()) : showLoginScreen()); }
      else { showAdminPanel(); loadNotices(); }
    });
    
    function showLoginScreen() { document.getElementById('loginScreen').style.display = 'flex'; document.getElementById('adminLayout').style.display = 'none'; }
    function showAdminPanel() { document.getElementById('loginScreen').style.display = 'none'; document.getElementById('adminLayout').style.display = 'flex'; }
    function signInWithGoogle() { alert('ë°ëª¨ ëª¨ë“œ'); showAdminPanel(); loadNotices(); }
    function signOut() { showLoginScreen(); }
    
    async function loadNotices() {
      document.getElementById('loadingState').style.display = 'block';
      document.getElementById('noticesTableBody').innerHTML = '';
      document.getElementById('emptyState').style.display = 'none';
      
      try {
        const res = await fetch(`tables/${TABLE_NAME}?limit=100&sort=-created_at`);
        if (res.ok) { const data = await res.json(); allNotices = data.data || []; }
        else { allNotices = getSampleNotices(); }
      } catch { allNotices = getSampleNotices(); }
      
      document.getElementById('loadingState').style.display = 'none';
      renderTable();
    }
    
    function getSampleNotices() {
      return [
        { id: '1', title: '2024ë…„ ì—°ë§ ì§„ë£Œ ì•ˆë‚´', category: 'holiday', is_pinned: true, created_at: Date.now() - 86400000 * 2 },
        { id: '2', title: 'ì¸ë¹„ì ˆë¼ì¸ ì—°ë§ í”„ë¡œëª¨ì…˜', category: 'event', is_pinned: true, created_at: Date.now() - 86400000 * 5 },
        { id: '3', title: 'ìƒˆë¡œìš´ ì¥ë¹„ ë„ì… ì•ˆë‚´', category: 'info', is_pinned: false, created_at: Date.now() - 86400000 * 7 }
      ];
    }
    
    function renderTable() {
      const tbody = document.getElementById('noticesTableBody');
      const empty = document.getElementById('emptyState');
      if (!allNotices.length) { tbody.innerHTML = ''; empty.style.display = 'block'; return; }
      empty.style.display = 'none';
      tbody.innerHTML = allNotices.map(n => {
        const catLabels = { important: 'ì¤‘ìš”', event: 'ì´ë²¤íŠ¸', info: 'ì•ˆë‚´', holiday: 'íœ´ì§„' };
        const date = new Date(n.created_at).toLocaleDateString('ko-KR');
        return `<tr>
          <td>${n.is_pinned ? '<i class="fas fa-thumbtack pin-icon"></i>' : ''}</td>
          <td>${escapeHtml(n.title)}</td>
          <td><span class="category-badge ${n.category}">${catLabels[n.category] || n.category}</span></td>
          <td>${date}</td>
          <td><div class="action-btns">
            <button class="btn-icon" onclick="editNotice('${n.id}')"><i class="fas fa-edit"></i></button>
            <button class="btn-icon delete" onclick="deleteNotice('${n.id}')"><i class="fas fa-trash"></i></button>
          </div></td>
        </tr>`;
      }).join('');
    }
    
    function filterNotices() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const filtered = allNotices.filter(n => n.title.toLowerCase().includes(search));
      const temp = allNotices;
      allNotices = filtered;
      renderTable();
      allNotices = temp;
    }
    
    function openModal(id = null) {
      editingId = id;
      document.getElementById('modalTitle').textContent = id ? 'ê³µì§€ ìˆ˜ì •' : 'ìƒˆ ê³µì§€ ì¶”ê°€';
      document.getElementById('noticeForm').reset();
      if (id) {
        const n = allNotices.find(x => x.id === id);
        if (n) {
          document.getElementById('noticeId').value = n.id;
          document.getElementById('noticeTitle').value = n.title || '';
          document.getElementById('noticeCategory').value = n.category || 'info';
          document.getElementById('noticePinned').checked = n.is_pinned || false;
          document.getElementById('noticeContent').value = n.content || '';
        }
      }
      document.getElementById('noticeModal').classList.add('active');
    }
    
    function closeModal() { document.getElementById('noticeModal').classList.remove('active'); editingId = null; }
    function editNotice(id) { openModal(id); }
    
    async function saveNotice() {
      const title = document.getElementById('noticeTitle').value.trim();
      const category = document.getElementById('noticeCategory').value;
      const content = document.getElementById('noticeContent').value.trim();
      if (!title || !content) { alert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
      
      const data = { title, category, content, is_pinned: document.getElementById('noticePinned').checked };
      
      try {
        const url = editingId ? `tables/${TABLE_NAME}/${editingId}` : `tables/${TABLE_NAME}`;
        const method = editingId ? 'PUT' : 'POST';
        const res = await fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
        if (res.ok) { alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.'); closeModal(); loadNotices(); }
        else { throw new Error(); }
      } catch {
        if (editingId) { const i = allNotices.findIndex(x => x.id === editingId); if (i > -1) allNotices[i] = { ...allNotices[i], ...data }; }
        else { allNotices.unshift({ id: Date.now().toString(), ...data, created_at: Date.now() }); }
        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (ë°ëª¨)');
        closeModal();
        renderTable();
      }
    }
    
    async function deleteNotice(id) {
      if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      try { await fetch(`tables/${TABLE_NAME}/${id}`, { method: 'DELETE' }); loadNotices(); }
      catch { allNotices = allNotices.filter(x => x.id !== id); renderTable(); }
    }
    
    function escapeHtml(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }
    document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
  </script>
</body>
</html>
