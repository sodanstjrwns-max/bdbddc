<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  
  <!-- Google Analytics (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3NQP355YQM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-3NQP355YQM');
  </script>
  
  <!-- Amplitude Analytics -->
  <script src="https://cdn.amplitude.com/script/c4e197a17443b1059b402ec0d16fa88f.js"></script>
  <script>
    window.amplitude.add(window.sessionReplay.plugin({sampleRate: 1}));
    window.amplitude.init('c4e197a17443b1059b402ec0d16fa88f', {
      "fetchRemoteConfig": true,
      "autocapture": {
        "attribution": true,
        "fileDownloads": true,
        "formInteractions": true,
        "pageViews": true,
        "sessions": true,
        "elementInteractions": true,
        "networkTracking": true,
        "webVitals": true,
        "frustrationInteractions": true
      }
    });
  </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- SEO -->
  <title>Î°úÍ∑∏Ïù∏ | ÏÑúÏö∏ÎπÑÎîîÏπòÍ≥º</title>
  <meta name="description" content="ÏÑúÏö∏ÎπÑÎîîÏπòÍ≥º ÌöåÏõê Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÏûÖÎãàÎã§. Ïù¥Î©îÏùº ÎòêÎäî ÏÜåÏÖú Í≥ÑÏ†ïÏúºÎ°ú Î°úÍ∑∏Ïù∏ÌïòÏÑ∏Ïöî.">
  <meta name="robots" content="noindex, nofollow">
  
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶∑</text></svg>">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --brand-primary: #8B5A2B;
      --brand-gold: #C9A962;
      --brand-gradient: linear-gradient(135deg, #8B5A2B 0%, #C9A962 100%);
      --bg-dark: #0a0806;
      --bg-card: rgba(26, 20, 16, 0.95);
      --text-primary: #fff;
      --text-secondary: #b8a99a;
      --text-muted: #666;
      --border-color: rgba(139, 90, 43, 0.3);
      --error-color: #e74c3c;
      --success-color: #27ae60;
    }
    
    html { font-size: 16px; }
    
    body {
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    /* Header */
    .auth-header {
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid var(--border-color);
    }
    
    .auth-header a {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      color: var(--text-primary);
      font-size: 1.25rem;
      font-weight: 700;
    }
    
    .auth-header .logo-icon { font-size: 1.5rem; }
    
    /* Main Container */
    .auth-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
    }
    
    .auth-card {
      width: 100%;
      max-width: 440px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 24px;
      padding: 48px 40px;
      backdrop-filter: blur(20px);
    }
    
    .auth-title {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .auth-title h1 {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 8px;
      background: var(--brand-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .auth-title p {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    
    /* Form Styles */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-secondary);
    }
    
    .form-input {
      width: 100%;
      padding: 14px 16px;
      font-size: 1rem;
      font-family: inherit;
      color: var(--text-primary);
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      outline: none;
      transition: all 0.3s;
    }
    
    .form-input:focus {
      border-color: var(--brand-gold);
      box-shadow: 0 0 0 3px rgba(201, 169, 98, 0.1);
    }
    
    .form-input::placeholder {
      color: var(--text-muted);
    }
    
    .input-wrapper {
      position: relative;
    }
    
    .input-wrapper .form-input {
      padding-right: 48px;
    }
    
    .input-icon {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      cursor: pointer;
      transition: color 0.3s;
    }
    
    .input-icon:hover {
      color: var(--brand-gold);
    }
    
    /* Error Message */
    .error-message {
      display: none;
      padding: 12px 16px;
      margin-bottom: 20px;
      background: rgba(231, 76, 60, 0.1);
      border: 1px solid var(--error-color);
      border-radius: 12px;
      color: var(--error-color);
      font-size: 0.9rem;
      text-align: center;
    }
    
    .error-message.show {
      display: block;
    }
    
    /* Success Message */
    .success-message {
      display: none;
      padding: 12px 16px;
      margin-bottom: 20px;
      background: rgba(39, 174, 96, 0.1);
      border: 1px solid var(--success-color);
      border-radius: 12px;
      color: var(--success-color);
      font-size: 0.9rem;
      text-align: center;
    }
    
    .success-message.show {
      display: block;
    }
    
    /* Buttons */
    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      padding: 16px;
      font-size: 1rem;
      font-weight: 600;
      font-family: inherit;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background: var(--brand-gradient);
      color: #fff;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(139, 90, 43, 0.4);
    }
    
    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Divider */
    .divider {
      display: flex;
      align-items: center;
      margin: 28px 0;
      color: var(--text-muted);
      font-size: 0.85rem;
    }
    
    .divider::before,
    .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border-color);
    }
    
    .divider span {
      padding: 0 16px;
    }
    
    /* Social Buttons */
    .social-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .btn-social {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
    }
    
    .btn-social:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--brand-gold);
    }
    
    .btn-social img {
      width: 20px;
      height: 20px;
    }
    
    .btn-google { }
    .btn-kakao { background: #FEE500; color: #000; border-color: #FEE500; }
    .btn-kakao:hover { background: #F5DC00; }
    .btn-naver { background: #03C75A; color: #fff; border-color: #03C75A; }
    .btn-naver:hover { background: #02b351; }
    
    /* Links */
    .auth-links {
      margin-top: 24px;
      text-align: center;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    
    .auth-links a {
      color: var(--brand-gold);
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s;
    }
    
    .auth-links a:hover {
      color: var(--text-primary);
      text-decoration: underline;
    }
    
    .forgot-password {
      display: block;
      margin-top: 12px;
      text-align: center;
    }
    
    .forgot-password a {
      color: var(--text-muted);
      font-size: 0.85rem;
      text-decoration: none;
    }
    
    .forgot-password a:hover {
      color: var(--brand-gold);
    }
    
    /* Loading Overlay */
    .loading-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .loading-overlay.show {
      display: flex;
    }
    
    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 3px solid rgba(201, 169, 98, 0.2);
      border-top-color: var(--brand-gold);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Responsive */
    @media (max-width: 480px) {
      .auth-card {
        padding: 32px 24px;
        border-radius: 20px;
      }
      
      .auth-title h1 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="auth-header">
    <a href="../index.html">
      <span class="logo-icon">ü¶∑</span>
      <span data-i18n="common.clinicName">ÏÑúÏö∏ÎπÑÎîîÏπòÍ≥º</span>
    </a>
    <!-- Language Selector -->
    <select id="langSelect" class="lang-select" onchange="changeLanguage(this.value)">
      <option value="ko">ÌïúÍµ≠Ïñ¥</option>
      <option value="en">English</option>
      <option value="ja">Êó•Êú¨Ë™û</option>
      <option value="zh">‰∏≠Êñá</option>
    </select>
  </header>
  
  <style>
    .lang-select {
      padding: 6px 12px;
      background: rgba(255,255,255,0.1);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 0.85rem;
      cursor: pointer;
    }
  </style>

  <!-- Main Container -->
  <main class="auth-container">
    <div class="auth-card">
      <div class="auth-title">
        <h1 data-i18n="auth.loginTitle">Î°úÍ∑∏Ïù∏</h1>
        <p data-i18n="auth.loginWelcome">ÏÑúÏö∏ÎπÑÎîîÏπòÍ≥ºÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§</p>
      </div>
      
      <!-- Error/Success Messages -->
      <div id="errorMessage" class="error-message"></div>
      <div id="successMessage" class="success-message"></div>
      
      <!-- Login Form -->
      <form id="loginForm" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label class="form-label" for="email" data-i18n="auth.email">Ïù¥Î©îÏùº</label>
          <input 
            type="email" 
            id="email" 
            class="form-input" 
            data-i18n-placeholder="auth.emailPlaceholder"
            placeholder="Ïù¥Î©îÏùº Ï£ºÏÜåÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
            required
            autocomplete="email"
          >
        </div>
        
        <div class="form-group">
          <label class="form-label" for="password" data-i18n="auth.password">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
          <div class="input-wrapper">
            <input 
              type="password" 
              id="password" 
              class="form-input" 
              data-i18n-placeholder="auth.passwordPlaceholder"
              placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
              required
              autocomplete="current-password"
            >
            <i class="fas fa-eye input-icon" onclick="togglePassword()"></i>
          </div>
        </div>
        
        <button type="submit" class="btn btn-primary" id="loginBtn">
          <i class="fas fa-sign-in-alt"></i>
          <span data-i18n="auth.login">Î°úÍ∑∏Ïù∏</span>
        </button>
      </form>
      
      <div class="forgot-password">
        <a href="javascript:void(0)" onclick="showForgotPassword(event)" data-i18n="auth.forgotPassword">ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûäÏúºÏÖ®ÎÇòÏöî?</a>
      </div>
      
      <div class="divider">
        <span data-i18n="auth.continueWith">ÎòêÎäî</span>
      </div>
      
      <!-- Social Login -->
      <div class="social-buttons">
        <button type="button" class="btn btn-social btn-google" onclick="handleGoogleLogin()">
          <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
          <span data-i18n="auth.googleLogin">GoogleÎ°ú Í≥ÑÏÜçÌïòÍ∏∞</span>
        </button>
      </div>
      
      <div class="auth-links">
        <span data-i18n="auth.noAccount">Í≥ÑÏ†ïÏù¥ ÏóÜÏúºÏã†Í∞ÄÏöî?</span> <a href="register.html" data-i18n="auth.register">ÌöåÏõêÍ∞ÄÏûÖ</a>
      </div>
    </div>
  </main>

  <!-- Loading Overlay -->
  <div id="authLoader" class="loading-overlay">
    <div class="loading-spinner"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="/js/firebase-auth.js"></script>
  
  <script>
    // ÎπÑÎ∞ÄÎ≤àÌò∏ ÌëúÏãú/Ïà®ÍπÄ ÌÜ†Í∏Ä
    function togglePassword() {
      const passwordInput = document.getElementById('password');
      const icon = document.querySelector('.input-icon');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
      } else {
        passwordInput.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
      }
    }
    
    // ÏóêÎü¨ Î©îÏãúÏßÄ ÌëúÏãú
    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      errorDiv.textContent = message;
      errorDiv.classList.add('show');
      
      // ÏÑ±Í≥µ Î©îÏãúÏßÄ Ïà®ÍπÄ
      document.getElementById('successMessage').classList.remove('show');
    }
    
    // ÏÑ±Í≥µ Î©îÏãúÏßÄ ÌëúÏãú
    function showSuccess(message) {
      const successDiv = document.getElementById('successMessage');
      successDiv.textContent = message;
      successDiv.classList.add('show');
      
      // ÏóêÎü¨ Î©îÏãúÏßÄ Ïà®ÍπÄ
      document.getElementById('errorMessage').classList.remove('show');
    }
    
    // Î©îÏãúÏßÄ Ïà®ÍπÄ
    function hideMessages() {
      document.getElementById('errorMessage').classList.remove('show');
      document.getElementById('successMessage').classList.remove('show');
    }
    
    // Ïù¥Î©îÏùº Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
    async function handleLogin(event) {
      event.preventDefault();
      hideMessages();
      
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      
      // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
      if (!email || !password) {
        showError('Ïù¥Î©îÏùºÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }
      
      const result = await window.firebaseAuth.loginWithEmail(email, password);
      
      if (result.success) {
        showSuccess('Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ! Î©îÏù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.');
        setTimeout(() => {
          const redirectUrl = sessionStorage.getItem('loginRedirect') || '../index.html';
          sessionStorage.removeItem('loginRedirect');
          window.location.href = redirectUrl;
        }, 1000);
      } else {
        showError(result.error);
      }
    }
    
    // Google Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
    async function handleGoogleLogin() {
      hideMessages();
      
      const result = await window.firebaseAuth.loginWithGoogle();
      
      if (result.success) {
        showSuccess('Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ! Î©îÏù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.');
        setTimeout(() => {
          // ÏõêÎûò Í∞ÄÎ†§Îçò ÌéòÏù¥ÏßÄÍ∞Ä ÏûàÏúºÎ©¥ Í±∞Í∏∞Î°ú, ÏóÜÏúºÎ©¥ Î©îÏù∏ÏúºÎ°ú
          const redirectUrl = sessionStorage.getItem('loginRedirect') || '../index.html';
          sessionStorage.removeItem('loginRedirect');
          window.location.href = redirectUrl;
        }, 1000);
      } else {
        showError(result.error);
      }
    }
    
    // Ïπ¥Ïπ¥Ïò§ Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
    async function handleKakaoLogin() {
      hideMessages();
      
      try {
        const result = await window.firebaseAuth.loginWithKakao();
        
        if (result.success) {
          showSuccess('Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ! Î©îÏù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.');
          setTimeout(() => {
            const redirectUrl = sessionStorage.getItem('loginRedirect') || '../index.html';
            sessionStorage.removeItem('loginRedirect');
            window.location.href = redirectUrl;
          }, 1000);
        } else {
          showError(result.error);
        }
      } catch (error) {
        showError(error.error || 'Ïπ¥Ïπ¥Ïò§ Î°úÍ∑∏Ïù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
      }
    }
    
    // ÎπÑÎ∞ÄÎ≤àÌò∏ Ï∞æÍ∏∞
    async function showForgotPassword(event) {
      event.preventDefault();
      hideMessages();
      
      const email = document.getElementById('email').value.trim();
      
      if (!email) {
        showError('ÎπÑÎ∞ÄÎ≤àÌò∏ Ïû¨ÏÑ§Ï†ïÏùÑ ÏúÑÌï¥ Ïù¥Î©îÏùºÏùÑ Î®ºÏ†Ä ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        document.getElementById('email').focus();
        return;
      }
      
      if (!window.firebaseAuth.validateEmail(email)) {
        showError('Ïò¨Î∞îÎ•∏ Ïù¥Î©îÏùº ÌòïÏãùÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }
      
      const result = await window.firebaseAuth.sendPasswordReset(email);
      
      if (result.success) {
        showSuccess('ÎπÑÎ∞ÄÎ≤àÌò∏ Ïû¨ÏÑ§Ï†ï Ïù¥Î©îÏùºÏùÑ Î∞úÏÜ°ÌñàÏäµÎãàÎã§. Î©îÏùºÌï®ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
      } else {
        showError(result.error);
      }
    }
    
    // Ïù¥ÎØ∏ Î°úÍ∑∏Ïù∏Îêú Í≤ΩÏö∞ Î©îÏù∏ÏúºÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏
    window.addEventListener('authStateChanged', (e) => {
      if (e.detail.user) {
        // Ïù¥ÎØ∏ Î°úÍ∑∏Ïù∏Îê® - Î©îÏù∏ÏúºÎ°ú Ïù¥Îèô
        // window.location.href = '../index.html';
      }
    });
    
    // ========== Îã§Íµ≠Ïñ¥ ÏßÄÏõê ==========
    function changeLanguage(lang) {
      localStorage.setItem('seoulbd_language', lang);
      applyTranslations(lang);
    }
    
    function getTranslation(key, lang) {
      if (!window.TRANSLATIONS) return null;
      const keys = key.split('.');
      let value = window.TRANSLATIONS;
      for (const k of keys) {
        value = value?.[k];
      }
      // Ìï¥Îãπ Ïñ∏Ïñ¥ Í∞íÏù¥ ÏóÜÏúºÎ©¥ ÌïúÍµ≠Ïñ¥ Í∏∞Î≥∏Í∞í Î∞òÌôò
      return value ? (value[lang] || value['ko']) : null;
    }
    
    function applyTranslations(lang) {
      if (!window.TRANSLATIONS) return;
      
      // ÏùºÎ∞ò ÌÖçÏä§Ìä∏ Î≤àÏó≠
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const translation = getTranslation(key, lang);
        if (translation) {
          el.textContent = translation;
        }
      });
      
      // placeholder Î≤àÏó≠
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        const translation = getTranslation(key, lang);
        if (translation) {
          el.placeholder = translation;
        }
      });
      
      // select ÏòµÏÖò Î≤àÏó≠
      document.querySelectorAll('select option[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const translation = getTranslation(key, lang);
        if (translation) {
          el.textContent = translation;
        }
      });
      
      // HTML ÏÜçÏÑ± ÏóÖÎç∞Ïù¥Ìä∏
      document.documentElement.lang = lang;
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      const savedLang = localStorage.getItem('seoulbd_language') || 'ko';
      document.getElementById('langSelect').value = savedLang;
      applyTranslations(savedLang);
    });
  </script>
  <script src="/js/gnb.js?v=20241229" defer></script>
  <script src="/js/translations.js?v=20241229"></script>
  <!-- AI Ï±óÎ¥á -->
  <script defer src="/js/chatbot.js"></script>
</body>
</html>
