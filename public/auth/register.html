<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  
  <!-- Google Analytics (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3NQP355YQM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-3NQP355YQM');
  </script>
  
  <!-- Amplitude Analytics -->
  <script src="https://cdn.amplitude.com/script/c4e197a17443b1059b402ec0d16fa88f.js"></script>
  <script>
    window.amplitude.add(window.sessionReplay.plugin({sampleRate: 1}));
    window.amplitude.init('c4e197a17443b1059b402ec0d16fa88f', {
      "fetchRemoteConfig": true,
      "autocapture": {
        "attribution": true,
        "fileDownloads": true,
        "formInteractions": true,
        "pageViews": true,
        "sessions": true,
        "elementInteractions": true,
        "networkTracking": true,
        "webVitals": true,
        "frustrationInteractions": true
      }
    });
  </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- SEO -->
  <title>íšŒì›ê°€ì… | ì„œìš¸ë¹„ë””ì¹˜ê³¼</title>
  <meta name="description" content="ì„œìš¸ë¹„ë””ì¹˜ê³¼ íšŒì›ê°€ì… í˜ì´ì§€ì…ë‹ˆë‹¤. íšŒì›ì´ ë˜ì‹œë©´ ì˜ˆì•½ ê´€ë¦¬, ì§„ë£Œ ì´ë ¥ í™•ì¸ ë“± ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.">
  <meta name="robots" content="noindex, nofollow">
  
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¦·</text></svg>">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --brand-primary: #8B5A2B;
      --brand-gold: #C9A962;
      --brand-gradient: linear-gradient(135deg, #8B5A2B 0%, #C9A962 100%);
      --bg-dark: #0a0806;
      --bg-card: rgba(26, 20, 16, 0.95);
      --text-primary: #fff;
      --text-secondary: #b8a99a;
      --text-muted: #666;
      --border-color: rgba(139, 90, 43, 0.3);
      --error-color: #e74c3c;
      --success-color: #27ae60;
    }
    
    html { font-size: 16px; scroll-behavior: smooth; }
    
    body {
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    /* Header */
    .auth-header {
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid var(--border-color);
    }
    
    .auth-header a {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      color: var(--text-primary);
      font-size: 1.25rem;
      font-weight: 700;
    }
    
    .auth-header .logo-icon { font-size: 1.5rem; }
    
    /* Main Container */
    .auth-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
    }
    
    .auth-card {
      width: 100%;
      max-width: 500px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 24px;
      padding: 48px 40px;
      backdrop-filter: blur(20px);
    }
    
    .auth-title {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .auth-title h1 {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 8px;
      background: var(--brand-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .auth-title p {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    
    /* Progress Steps */
    .progress-steps {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 32px;
    }
    
    .step {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--border-color);
      transition: all 0.3s;
    }
    
    .step.active {
      background: var(--brand-gold);
      width: 32px;
      border-radius: 5px;
    }
    
    .step.completed {
      background: var(--success-color);
    }
    
    /* Form Styles */
    .form-step {
      display: none;
    }
    
    .form-step.active {
      display: block;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-secondary);
    }
    
    .form-label .required {
      color: var(--error-color);
      margin-left: 2px;
    }
    
    .form-input {
      width: 100%;
      padding: 14px 16px;
      font-size: 1rem;
      font-family: inherit;
      color: var(--text-primary);
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      outline: none;
      transition: all 0.3s;
    }
    
    .form-input:focus {
      border-color: var(--brand-gold);
      box-shadow: 0 0 0 3px rgba(201, 169, 98, 0.1);
    }
    
    .form-input::placeholder {
      color: var(--text-muted);
    }
    
    .form-input.error {
      border-color: var(--error-color);
    }
    
    .form-input.success {
      border-color: var(--success-color);
    }
    
    .input-wrapper {
      position: relative;
    }
    
    .input-wrapper .form-input {
      padding-right: 48px;
    }
    
    .input-icon {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      cursor: pointer;
      transition: color 0.3s;
    }
    
    .input-icon:hover {
      color: var(--brand-gold);
    }
    
    .input-hint {
      margin-top: 6px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    
    .input-hint.error {
      color: var(--error-color);
    }
    
    .input-hint.success {
      color: var(--success-color);
    }
    
    /* Password Strength */
    .password-strength {
      display: flex;
      gap: 4px;
      margin-top: 8px;
    }
    
    .strength-bar {
      flex: 1;
      height: 4px;
      background: var(--border-color);
      border-radius: 2px;
      transition: background 0.3s;
    }
    
    .strength-bar.active {
      background: var(--error-color);
    }
    
    .strength-bar.active.medium {
      background: #f39c12;
    }
    
    .strength-bar.active.strong {
      background: var(--success-color);
    }
    
    /* Row Layout */
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    /* Select */
    .form-select {
      width: 100%;
      padding: 14px 16px;
      font-size: 1rem;
      font-family: inherit;
      color: var(--text-primary);
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      outline: none;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23666' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
    }
    
    .form-select option {
      background: #1a1410;
      color: var(--text-primary);
    }
    
    /* Checkbox */
    .checkbox-group {
      margin-bottom: 16px;
    }
    
    .checkbox-label {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      cursor: pointer;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    
    .checkbox-label input {
      display: none;
    }
    
    .checkbox-custom {
      width: 20px;
      height: 20px;
      min-width: 20px;
      border: 2px solid var(--border-color);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    
    .checkbox-label input:checked + .checkbox-custom {
      background: var(--brand-gold);
      border-color: var(--brand-gold);
    }
    
    .checkbox-custom i {
      color: #fff;
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .checkbox-label input:checked + .checkbox-custom i {
      opacity: 1;
    }
    
    .checkbox-text a {
      color: var(--brand-gold);
      text-decoration: underline;
    }
    
    .check-all {
      padding-bottom: 12px;
      margin-bottom: 12px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .check-all .checkbox-text {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    /* Error/Success Messages */
    .error-message, .success-message {
      display: none;
      padding: 12px 16px;
      margin-bottom: 20px;
      border-radius: 12px;
      font-size: 0.9rem;
      text-align: center;
    }
    
    .error-message {
      background: rgba(231, 76, 60, 0.1);
      border: 1px solid var(--error-color);
      color: var(--error-color);
    }
    
    .success-message {
      background: rgba(39, 174, 96, 0.1);
      border: 1px solid var(--success-color);
      color: var(--success-color);
    }
    
    .error-message.show, .success-message.show {
      display: block;
    }
    
    /* Buttons */
    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      padding: 16px;
      font-size: 1rem;
      font-weight: 600;
      font-family: inherit;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background: var(--brand-gradient);
      color: #fff;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(139, 90, 43, 0.4);
    }
    
    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-secondary {
      background: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
    }
    
    .btn-secondary:hover {
      border-color: var(--brand-gold);
      color: var(--brand-gold);
    }
    
    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }
    
    .btn-group .btn {
      flex: 1;
    }
    
    /* Divider */
    .divider {
      display: flex;
      align-items: center;
      margin: 28px 0;
      color: var(--text-muted);
      font-size: 0.85rem;
    }
    
    .divider::before, .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border-color);
    }
    
    .divider span {
      padding: 0 16px;
    }
    
    /* Social Buttons */
    .social-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .btn-social {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
    }
    
    .btn-social:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--brand-gold);
    }
    
    .btn-social img {
      width: 20px;
      height: 20px;
    }
    
    /* Links */
    .auth-links {
      margin-top: 24px;
      text-align: center;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    
    .auth-links a {
      color: var(--brand-gold);
      text-decoration: none;
      font-weight: 600;
    }
    
    .auth-links a:hover {
      text-decoration: underline;
    }
    
    /* Loading */
    .loading-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .loading-overlay.show {
      display: flex;
    }
    
    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 3px solid rgba(201, 169, 98, 0.2);
      border-top-color: var(--brand-gold);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Responsive */
    @media (max-width: 480px) {
      .auth-card {
        padding: 32px 20px;
        border-radius: 20px;
      }
      
      .auth-title h1 {
        font-size: 1.5rem;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="auth-header">
    <a href="../index.html">
      <span class="logo-icon">ğŸ¦·</span>
      <span data-i18n="common.clinicName">ì„œìš¸ë¹„ë””ì¹˜ê³¼</span>
    </a>
    <select id="langSelect" class="lang-select" onchange="changeLanguage(this.value)">
      <option value="ko">í•œêµ­ì–´</option>
      <option value="en">English</option>
      <option value="ja">æ—¥æœ¬èª</option>
      <option value="zh">ä¸­æ–‡</option>
    </select>
  </header>
  
  <style>
    .lang-select {
      padding: 6px 12px;
      background: rgba(255,255,255,0.1);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 0.85rem;
      cursor: pointer;
    }
  </style>

  <!-- Main Container -->
  <main class="auth-container">
    <div class="auth-card">
      <div class="auth-title">
        <h1 data-i18n="auth.registerTitle">íšŒì›ê°€ì…</h1>
        <p data-i18n="auth.registerWelcome">ì„œìš¸ë¹„ë””ì¹˜ê³¼ íšŒì›ì´ ë˜ì–´ ë‹¤ì–‘í•œ í˜œíƒì„ ëˆ„ë¦¬ì„¸ìš”</p>
      </div>
      
      <!-- Progress Steps -->
      <div class="progress-steps">
        <div class="step active" data-step="1"></div>
        <div class="step" data-step="2"></div>
        <div class="step" data-step="3"></div>
      </div>
      
      <!-- Messages -->
      <div id="errorMessage" class="error-message"></div>
      <div id="successMessage" class="success-message"></div>
      
      <!-- Registration Form -->
      <form id="registerForm">
        <!-- Step 1: ê¸°ë³¸ ì •ë³´ -->
        <div class="form-step active" data-step="1">
          <div class="form-group">
            <label class="form-label" for="email">
              <span data-i18n="auth.email">ì´ë©”ì¼</span> <span class="required">*</span>
            </label>
            <input 
              type="email" 
              id="email" 
              class="form-input" 
              data-i18n-placeholder="auth.emailPlaceholder"
              placeholder="ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
              required
            >
            <p class="input-hint" id="emailHint"></p>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="password">
              <span data-i18n="auth.password">ë¹„ë°€ë²ˆí˜¸</span> <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <input 
                type="password" 
                id="password" 
                class="form-input" 
                data-i18n-placeholder="auth.passwordPlaceholder"
                placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                required
                minlength="8"
              >
              <i class="fas fa-eye input-icon" onclick="togglePassword('password')"></i>
            </div>
            <div class="password-strength" id="passwordStrength">
              <div class="strength-bar"></div>
              <div class="strength-bar"></div>
              <div class="strength-bar"></div>
              <div class="strength-bar"></div>
            </div>
            <p class="input-hint" data-i18n="auth.passwordHint">8ì ì´ìƒ, ì˜ë¬¸+ìˆ«ì ì¡°í•© í•„ìˆ˜</p>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="passwordConfirm">
              <span data-i18n="auth.passwordConfirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</span> <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <input 
                type="password" 
                id="passwordConfirm" 
                class="form-input" 
                data-i18n-placeholder="auth.passwordConfirmPlaceholder"
                placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”"
                required
              >
              <i class="fas fa-eye input-icon" onclick="togglePassword('passwordConfirm')"></i>
            </div>
            <p class="input-hint" id="passwordConfirmHint"></p>
          </div>
          
          <button type="button" class="btn btn-primary" onclick="nextStep(1)">
            <span data-i18n="auth.nextStep">ë‹¤ìŒ ë‹¨ê³„</span>
            <i class="fas fa-arrow-right"></i>
          </button>
          
          <div class="divider">
            <span data-i18n="auth.continueWith">ë˜ëŠ”</span>
          </div>
          
          <div class="social-buttons">
            <button type="button" class="btn btn-social" onclick="handleGoogleRegister()">
              <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
              <span data-i18n="auth.googleRegister">Googleë¡œ ê°€ì…í•˜ê¸°</span>
            </button>
          </div>
        </div>
        
        <!-- Step 2: ê°œì¸ ì •ë³´ -->
        <div class="form-step" data-step="2">
          <div class="form-group">
            <label class="form-label" for="name">
              <span data-i18n="auth.name">ì´ë¦„</span> <span class="required">*</span>
            </label>
            <input 
              type="text" 
              id="name" 
              class="form-input" 
              data-i18n-placeholder="auth.namePlaceholder"
              placeholder="ì‹¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
              required
            >
          </div>
          
          <div class="form-group">
            <label class="form-label" for="phone">
              <span data-i18n="auth.phone">íœ´ëŒ€í° ë²ˆí˜¸</span> <span class="required">*</span>
            </label>
            <input 
              type="tel" 
              id="phone" 
              class="form-input" 
              data-i18n-placeholder="auth.phonePlaceholder"
              placeholder="010-0000-0000"
              required
            >
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="birthdate" data-i18n="auth.birthdate">ìƒë…„ì›”ì¼</label>
              <input 
                type="date" 
                id="birthdate" 
                class="form-input"
              >
            </div>
            
            <div class="form-group">
              <label class="form-label" for="gender" data-i18n="auth.gender">ì„±ë³„</label>
              <select id="gender" class="form-select">
                <option value="" data-i18n="auth.notSelected">ì„ íƒ ì•ˆí•¨</option>
                <option value="male" data-i18n="auth.male">ë‚¨ì„±</option>
                <option value="female" data-i18n="auth.female">ì—¬ì„±</option>
              </select>
            </div>
          </div>
          
          <div class="btn-group">
            <button type="button" class="btn btn-secondary" onclick="prevStep(2)">
              <i class="fas fa-arrow-left"></i>
              <span data-i18n="auth.prevStep">ì´ì „</span>
            </button>
            <button type="button" class="btn btn-primary" onclick="nextStep(2)">
              <span data-i18n="auth.nextStep">ë‹¤ìŒ ë‹¨ê³„</span>
              <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>
        
        <!-- Step 3: ì•½ê´€ ë™ì˜ -->
        <div class="form-step" data-step="3">
          <div class="checkbox-group check-all">
            <label class="checkbox-label">
              <input type="checkbox" id="agreeAll" onchange="toggleAllAgree()">
              <span class="checkbox-custom"><i class="fas fa-check"></i></span>
              <span class="checkbox-text" data-i18n="auth.agreeAll">ì „ì²´ ë™ì˜</span>
            </label>
          </div>
          
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" id="agreedTerms" required>
              <span class="checkbox-custom"><i class="fas fa-check"></i></span>
              <span class="checkbox-text">
                <span data-i18n="auth.agreeTermsPrefix">[í•„ìˆ˜]</span> <a href="javascript:void(0)" onclick="showTerms('terms')" data-i18n="footer.terms">ì´ìš©ì•½ê´€</a> <span data-i18n="auth.agreeTermsSuffix">ë™ì˜</span>
              </span>
            </label>
          </div>
          
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" id="agreedPrivacy" required>
              <span class="checkbox-custom"><i class="fas fa-check"></i></span>
              <span class="checkbox-text">
                <span data-i18n="auth.agreePrivacyPrefix">[í•„ìˆ˜]</span> <a href="javascript:void(0)" onclick="showTerms('privacy')" data-i18n="footer.privacy">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</a> <span data-i18n="auth.agreePrivacySuffix">ë™ì˜</span>
              </span>
            </label>
          </div>
          
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" id="agreedMarketing">
              <span class="checkbox-custom"><i class="fas fa-check"></i></span>
              <span class="checkbox-text" data-i18n="auth.agreeMarketing">
                [ì„ íƒ] ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜ (ì´ë²¤íŠ¸, í• ì¸ í˜œíƒ ë“±)
              </span>
            </label>
          </div>
          
          <div class="btn-group" style="margin-top: 24px;">
            <button type="button" class="btn btn-secondary" onclick="prevStep(3)">
              <i class="fas fa-arrow-left"></i>
              <span data-i18n="auth.prevStep">ì´ì „</span>
            </button>
            <button type="submit" class="btn btn-primary" id="submitBtn">
              <i class="fas fa-user-plus"></i>
              <span data-i18n="auth.completeRegister">ê°€ì… ì™„ë£Œ</span>
            </button>
          </div>
        </div>
      </form>
      
      <div class="auth-links">
        <span data-i18n="auth.haveAccount">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?</span> <a href="login.html" data-i18n="auth.login">ë¡œê·¸ì¸</a>
      </div>
    </div>
  </main>

  <!-- Loading Overlay -->
  <div id="authLoader" class="loading-overlay">
    <div class="loading-spinner"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="/js/firebase-auth.js"></script>
  
  <script>
    let currentStep = 1;
    
    // ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¹€
    function togglePassword(fieldId) {
      const input = document.getElementById(fieldId);
      const icon = input.nextElementSibling;
      
      if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
      } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
      }
    }
    
    // ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬
    document.getElementById('email').addEventListener('input', function() {
      const hint = document.getElementById('emailHint');
      const isValid = window.firebaseAuth?.validateEmail(this.value);
      
      if (this.value && !isValid) {
        this.classList.add('error');
        this.classList.remove('success');
        hint.textContent = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤';
        hint.classList.add('error');
      } else if (this.value && isValid) {
        this.classList.remove('error');
        this.classList.add('success');
        hint.textContent = '';
        hint.classList.remove('error');
      } else {
        this.classList.remove('error', 'success');
        hint.textContent = '';
      }
    });
    
    // ë¹„ë°€ë²ˆí˜¸ ê°•ë„ í‘œì‹œ
    document.getElementById('password').addEventListener('input', function() {
      const strength = window.firebaseAuth?.validatePassword(this.value);
      const bars = document.querySelectorAll('.strength-bar');
      
      bars.forEach((bar, index) => {
        bar.classList.remove('active', 'medium', 'strong');
        
        if (strength && index < strength.strength) {
          bar.classList.add('active');
          if (strength.strength >= 3) bar.classList.add('strong');
          else if (strength.strength >= 2) bar.classList.add('medium');
        }
      });
      
      checkPasswordMatch();
    });
    
    // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
    document.getElementById('passwordConfirm').addEventListener('input', checkPasswordMatch);
    
    function checkPasswordMatch() {
      const password = document.getElementById('password').value;
      const confirm = document.getElementById('passwordConfirm').value;
      const hint = document.getElementById('passwordConfirmHint');
      const input = document.getElementById('passwordConfirm');
      
      if (confirm && password !== confirm) {
        input.classList.add('error');
        input.classList.remove('success');
        hint.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤';
        hint.classList.add('error');
        hint.classList.remove('success');
      } else if (confirm && password === confirm) {
        input.classList.remove('error');
        input.classList.add('success');
        hint.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤';
        hint.classList.remove('error');
        hint.classList.add('success');
      } else {
        input.classList.remove('error', 'success');
        hint.textContent = '';
        hint.classList.remove('error', 'success');
      }
    }
    
    // ì „í™”ë²ˆí˜¸ ìë™ í¬ë§·íŒ…
    document.getElementById('phone').addEventListener('input', function() {
      let value = this.value.replace(/\D/g, '');
      if (value.length > 3 && value.length <= 7) {
        value = value.replace(/(\d{3})(\d+)/, '$1-$2');
      } else if (value.length > 7) {
        value = value.replace(/(\d{3})(\d{4})(\d+)/, '$1-$2-$3');
      }
      this.value = value.substring(0, 13);
    });
    
    // ë‹¨ê³„ ì´ë™
    function nextStep(step) {
      hideMessages();
      
      // ìœ íš¨ì„± ê²€ì‚¬
      if (step === 1) {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const passwordConfirm = document.getElementById('passwordConfirm').value;
        
        if (!email || !window.firebaseAuth?.validateEmail(email)) {
          showError('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        
        const strength = window.firebaseAuth?.validatePassword(password);
        if (!strength?.isValid) {
          showError('ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒ, ì˜ë¬¸+ìˆ«ì ì¡°í•©ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
          return;
        }
        
        if (password !== passwordConfirm) {
          showError('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
          return;
        }
      }
      
      if (step === 2) {
        const name = document.getElementById('name').value.trim();
        const phone = document.getElementById('phone').value.trim();
        
        if (!name) {
          showError('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        
        if (!phone || phone.replace(/-/g, '').length < 10) {
          showError('ì˜¬ë°”ë¥¸ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
      }
      
      // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
      goToStep(step + 1);
    }
    
    function prevStep(step) {
      goToStep(step - 1);
    }
    
    function goToStep(step) {
      currentStep = step;
      
      // ëª¨ë“  ìŠ¤í… ìˆ¨ê¸°ê¸°
      document.querySelectorAll('.form-step').forEach(el => {
        el.classList.remove('active');
      });
      
      // í˜„ì¬ ìŠ¤í… í‘œì‹œ
      document.querySelector(`.form-step[data-step="${step}"]`).classList.add('active');
      
      // í”„ë¡œê·¸ë ˆìŠ¤ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.progress-steps .step').forEach(el => {
        const stepNum = parseInt(el.dataset.step);
        el.classList.remove('active', 'completed');
        
        if (stepNum === step) {
          el.classList.add('active');
        } else if (stepNum < step) {
          el.classList.add('completed');
        }
      });
    }
    
    // ì „ì²´ ë™ì˜
    function toggleAllAgree() {
      const allChecked = document.getElementById('agreeAll').checked;
      document.getElementById('agreedTerms').checked = allChecked;
      document.getElementById('agreedPrivacy').checked = allChecked;
      document.getElementById('agreedMarketing').checked = allChecked;
    }
    
    // ê°œë³„ ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ ì „ì²´ ë™ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸
    ['agreedTerms', 'agreedPrivacy', 'agreedMarketing'].forEach(id => {
      document.getElementById(id).addEventListener('change', function() {
        const terms = document.getElementById('agreedTerms').checked;
        const privacy = document.getElementById('agreedPrivacy').checked;
        const marketing = document.getElementById('agreedMarketing').checked;
        document.getElementById('agreeAll').checked = terms && privacy && marketing;
      });
    });
    
    // ì•½ê´€ ë³´ê¸°
    function showTerms(type) {
      const urls = {
        terms: '../terms.html',
        privacy: '../privacy.html'
      };
      window.open(urls[type] || '#', '_blank', 'width=600,height=700');
    }
    
    // ì—ëŸ¬/ì„±ê³µ ë©”ì‹œì§€
    function showError(message) {
      const el = document.getElementById('errorMessage');
      el.textContent = message;
      el.classList.add('show');
      document.getElementById('successMessage').classList.remove('show');
    }
    
    function showSuccess(message) {
      const el = document.getElementById('successMessage');
      el.textContent = message;
      el.classList.add('show');
      document.getElementById('errorMessage').classList.remove('show');
    }
    
    function hideMessages() {
      document.getElementById('errorMessage').classList.remove('show');
      document.getElementById('successMessage').classList.remove('show');
    }
    
    // íšŒì›ê°€ì… ì œì¶œ
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      hideMessages();
      
      // ì•½ê´€ ë™ì˜ í™•ì¸
      if (!document.getElementById('agreedTerms').checked) {
        showError('ì´ìš©ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (!document.getElementById('agreedPrivacy').checked) {
        showError('ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const userData = {
        name: document.getElementById('name').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        birthdate: document.getElementById('birthdate').value,
        gender: document.getElementById('gender').value,
        agreedTerms: document.getElementById('agreedTerms').checked,
        agreedPrivacy: document.getElementById('agreedPrivacy').checked,
        agreedMarketing: document.getElementById('agreedMarketing').checked
      };
      
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      
      const result = await window.firebaseAuth.registerWithEmail(email, password, userData);
      
      if (result.success) {
        showSuccess('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 2000);
      } else {
        showError(result.error);
      }
    });
    
    // Google íšŒì›ê°€ì…
    async function handleGoogleRegister() {
      hideMessages();
      
      const result = await window.firebaseAuth.loginWithGoogle();
      
      if (result.success) {
        if (result.isNewUser) {
          showSuccess('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        } else {
          showSuccess('ì´ë¯¸ ê°€ì…ëœ ê³„ì •ì…ë‹ˆë‹¤. ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        setTimeout(() => {
          window.location.href = '../index.html';
        }, 1500);
      } else {
        showError(result.error);
      }
    }
    
    // ========== ë‹¤êµ­ì–´ ì§€ì› ==========
    function changeLanguage(lang) {
      localStorage.setItem('seoulbd_language', lang);
      applyTranslations(lang);
    }
    
    function getTranslation(key, lang) {
      if (!window.TRANSLATIONS) return null;
      const keys = key.split('.');
      let value = window.TRANSLATIONS;
      for (const k of keys) {
        value = value?.[k];
      }
      // í•´ë‹¹ ì–¸ì–´ ê°’ì´ ì—†ìœ¼ë©´ í•œêµ­ì–´ ê¸°ë³¸ê°’ ë°˜í™˜
      return value ? (value[lang] || value['ko']) : null;
    }
    
    function applyTranslations(lang) {
      if (!window.TRANSLATIONS) return;
      
      // ì¼ë°˜ í…ìŠ¤íŠ¸ ë²ˆì—­
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const translation = getTranslation(key, lang);
        if (translation) {
          el.textContent = translation;
        }
      });
      
      // placeholder ë²ˆì—­
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        const translation = getTranslation(key, lang);
        if (translation) {
          el.placeholder = translation;
        }
      });
      
      // select ì˜µì…˜ ë²ˆì—­
      document.querySelectorAll('select option[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const translation = getTranslation(key, lang);
        if (translation) {
          el.textContent = translation;
        }
      });
      
      // HTML ì†ì„± ì—…ë°ì´íŠ¸
      document.documentElement.lang = lang;
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      const savedLang = localStorage.getItem('seoulbd_language') || 'ko';
      document.getElementById('langSelect').value = savedLang;
      applyTranslations(savedLang);
    });
  </script>
  <script src="/js/gnb.js" defer></script>
  <script src="/js/translations.js"></script>
</body>
</html>
